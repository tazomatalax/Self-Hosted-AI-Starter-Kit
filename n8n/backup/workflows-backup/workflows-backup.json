[{"createdAt":"2024-10-27T20:26:20.318Z","updatedAt":"2024-10-27T20:35:24.736Z","id":"8eJuRNeyYV3DC4rI","name":"Multi-Agent PDF-to-Blog Content Generation custom","active":false,"nodes":[{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"968017c0-1bb9-4f51-82cd-cf59faeea277","name":"Merge chapters title and text","type":"n8n-nodes-base.merge","position":[2980,360],"typeVersion":2.1},{"parameters":{"jsCode":"let article = \"\";\n\n// Introduction\narticle += $('Project Planner').first().json.message.content.introduction;\n\nfor (const item of $input.all()) {\n  article += \"<strong>\" + item.json.title + \"</strong>\";\n  article += item.json.output;\n  article += \"<br>\";\n}\n\n// Conclusions\narticle += \"<strong> Conclusions </strong>\";\narticle += $('Project Planner').first().json.message.content.conclusions;\n\n\nreturn [\n  {\n    \"article\": article\n  }\n];"},"id":"4939c6b9-f89e-441b-b42a-819a9c2d75a6","name":"Final article text","type":"n8n-nodes-base.code","position":[3240,360],"typeVersion":1},{"parameters":{"path":"e32a11e2-52a6-4c54-b05b-92832392f92e","formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Tone","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Professional"},{"option":"Causal"},{"option":"Witty"}]},"requiredField":true},{"fieldLabel":"Number of words","placeholder":"1000","requiredField":true},{"fieldLabel":"Number of sections","placeholder":"6","requiredField":true},{"fieldLabel":"File","fieldType":"file","multipleFiles":false,"requiredField":true}]},"options":{}},"id":"d0a005e2-e180-4ca5-a602-8cb2b12ad84a","name":"n8n Form Trigger","type":"n8n-nodes-base.formTrigger","position":[1000,360],"webhookId":"e32a11e2-52a6-4c54-b05b-92832392f92e","typeVersion":2.1},{"parameters":{"operation":"pdf","binaryPropertyName":"File","options":{}},"id":"bb4f9c96-58f6-4be0-91e5-a75c32fb3494","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","position":[1240,360],"typeVersion":1},{"parameters":{"source":"adminApi","operation":"create","title":"={{ $json.text }}","content":"={{ $('Editor').item.json.output }}","additionalFields":{}},"id":"e70696be-e8b8-4f48-a3da-e3b07754956a","name":"Ghost","type":"n8n-nodes-base.ghost","position":[4280,360],"typeVersion":1},{"parameters":{"fieldToSplitOut":"message.content.chapters","options":{}},"id":"83c08dcd-39f5-401e-9b29-c0154696c5ab","name":"Delegate to Writers","type":"n8n-nodes-base.splitOut","position":[2260,360],"typeVersion":1},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=Article to edit:\n {{ $json.article }}\n\nProvide polished output in html format. ","options":{"systemMessage":"=You are an expert Editor specializing in refining and polishing content to ensure it meets the highest quality standards. Your role is to review and improve the written material produced by the Writer. Your task is to provide an highly polished article. \n\nInstructions:\n1. Carefully read the entire content piece.\n2. Check for grammar, spelling, and punctuation errors.\n3. Ensure consistency in tone, style, and voice throughout the piece.\n4. Verify that the content aligns with the original brief and project requirements.\n5. Improve sentence structure and flow for better readability.\n6. Fact-check and verify the accuracy of information and citations.\n7. Optimize headlines, subheadings, and formatting for better engagement.\n8. Suggest improvements or additions to enhance the overall quality of the content.\n\n"}},"id":"aab1a8d6-3f8f-494b-938c-0ba8f6e5563c","name":"Editor","type":"@n8n/n8n-nodes-langchain.agent","position":[3460,360],"typeVersion":1.6},{"parameters":{"content":"## Extract PDF and analyze content ⛏️\n","height":430.74703747002076,"width":524.2843893435219,"color":5},"id":"e13648c9-36b2-41b1-9177-85b309e007f7","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[1220,240],"typeVersion":1},{"parameters":{"content":"## Plan the work and Delegate to writers 📅\n","height":430.74703747002076,"width":576.6288165877254,"color":5},"id":"7a318ade-ed23-4989-b25b-e2e6f16b4504","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[1820,240],"typeVersion":1},{"parameters":{"content":"## Team of writers working on each chapter ✍️","height":427.13707697042037,"width":648.8280265797307,"color":5},"id":"671954ca-840e-412a-87dd-e7db9e6788e1","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[2480,240],"typeVersion":1},{"parameters":{"content":"## Editor polishing draft 📝 ","height":428.9420572202205,"width":650.6330068295307,"color":5},"id":"f4e9d495-bf20-485b-ba21-2298be78724c","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[3200,240],"typeVersion":1},{"parameters":{"content":"## Publish to Ghost 📰","height":428.9420572202205,"width":542.3341918415219,"color":5},"id":"990fe8ef-c151-4766-976d-97a95800e994","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[3900,240],"typeVersion":1},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=Write a chapter for the article: {{ $('Project Planner').item.json.message.content.title }}, {{ $('Project Planner').item.json.message.content.subtitle }}\n\nWrite the chapter titled {{ $json.title }}that {{ $json.prompt }}.\n\nDocument text as source of information to use to write the chapter:\n{{ $('Extract from File').item.json.text }}","options":{"systemMessage":"=You are a skilled writer specializing in creating engaging and informative content. Your task is to write a chapter in the blog.\n\nGuidelines:\n- Just return the plain text for each chapter (no JSON structure).\n- Use html format for output\n- Don't add internal titles or headings.\n- The length of each chapther should be around {{ Math.round($('n8n Form Trigger').item.json['Number of words'] - 120)/ $('n8n Form Trigger').item.json['Number of sections']}} words long- Go deep in the topic you treat, don't just throw some superficial info\n{{ $itemIndex > 0 ? \"- The previous chapter talks about \" + $input.all()[$itemIndex-1].json.title : \"\" }}\n{{ $itemIndex > 0 ? \"- The promt for the previous chapter is \" + $input.all()[$itemIndex-1].json.prompt : \"\" }}\n{{ $itemIndex < $input.all().length ? \"- The following chapter will talk about \" + $input.all()[$itemIndex+1].json.title: \"\" }}\n{{ $itemIndex < $input.all().length ? \"- The prompt for the following chapter is \" + $input.all()[$itemIndex+1].json.prompt : \"\" }}\n- Consider the previous and following chapters what writing the text for this chapter. The text must be coherent with the previous and following chapters.\n- This chapter should not repeat the concepts already exposed in the previous chapter.\n- This chapter is a part of a larger article so don't include an introduction or conclusions. This chapter should merge with the rest of the article.\n- Please write in a style that is {{ $('n8n Form Trigger').item.json.Tone }}\n"}},"id":"64484a38-6b91-4e1f-b416-bb567a8c94fb","name":"Writers","type":"@n8n/n8n-nodes-langchain.agent","position":[2560,360],"retryOnFail":true,"typeVersion":1.6},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"917ee486-b15e-40c6-90b2-422f8860130d","name":"Ollama Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[1440,540],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"promptType":"define","text":"=Suggest an engaging title based on the following article.  Please use plain text, no formating of any kind.\n {{ $json.output }}"},"id":"e66fa51e-a69e-4b00-a75d-b8fd75f3f15f","name":"Create title","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[3940,360],"typeVersion":1.4},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"5d7535f8-6966-4dff-9985-ee4c79552f49","name":"Ollama Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[3760,640],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"a2be8ab7-3700-403c-b3ad-c8db6433d194","name":"Ollama Chat Model2","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[460,460],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"78503b3b-6ae0-4800-9d92-f206d0ccc3c8","name":"Ollama Chat Model3","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[1880,560],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"agent":"planAndExecuteAgent","hasOutputParser":true,"options":{"humanMessageTemplate":"=Write the title, the subtitle, the chapters details, the introduction, the conclusions, and an image prompt for a SEO-friendly article.  \n\nPlease use this set of topics to create chapters:\n{{ $json.output }}\n\n\nInstructions:\n- Place the article title in a JSON field called `title`\n- Place the subtitle in a JSON field called `subtitle`\n- Place the introduction in a JSON field called `introduction`\n- In the introduction introduce the topic that is then explored in depth in the rest of the text\n- The introduction should be around 100 words\n- Place the conclusions in a JSON field called `conclusions`\n- The conclusions should be around 100 words\n- Use the conclusions to sum all said in the article and offer a conclusion to the reader\n- The image prompt will be used to produce a photographic cover image for the article and should depict the topics discussed in the article\n- Place the image prompt in a JSON field called `imagePrompt`\n- There should be {{ $('n8n Form Trigger').item.json['Number of sections'].toString() }} chapters.\n- For each chapter provide a title and an exaustive prompt that will be used to write the chapter text.\n- Place the chapters in an array field called `chapters`\n- For each chapter provide the fields `title` and `prompt`\n- The chapters should follow a logical flow and not repeat the same concepts.\n- The chapters should be one related to the other and not isolated blocks of text. The text should be fluent and folow a linear logic.\n- Don't start the chapters with \"Chapter 1\", \"Chapter 2\", \"Chapter 3\"... just write the title of the chapter\n- For the title and the capthers' titles don't use colons (`:`)\n- For the text, use html format\n- Please write in a style that is {{ $('n8n Form Trigger').item.json.Tone }}\n- Go deep in the topic you treat, don't just throw some superficial info\n\n\nPlease use this text as the source for all the information needed to create the chapter:\n{{ $('Extract from File').item.json.text }}"}},"id":"13353650-daed-4141-95ad-98bd3417a229","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[1880,360]},{"parameters":{},"id":"258cc95c-2f7d-4b5f-9382-c82219283251","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[2060,540]},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"b731dace-0673-464d-990c-4e075630610d","name":"Ollama Chat Model4","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[2600,560],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"You are a Content Analyst specialized in document analysis and content structuring. Your task is to analyze a given document and create a comprehensive table of contents that can serve as the basis for a blog post. Follow these steps:\n\n1. Carefully read and understand the entire document provided.\n\n2. Identify the main topic or theme of the document.\n\n3. Recognize the key points, arguments, or sections within the document.\n\n4. Organize these key elements into a logical and hierarchical structure.\n\n5. Create a table of contents with main sections and subsections that accurately reflect the document's content and flow.\n\n6. Ensure that the table of contents is suitable for a blog post format, with clear and engaging headings.\n\n7. Include a brief introduction at the beginning of the table of contents to summarize the main topic.\n\n8. Add a conclusion section at the end to wrap up the key points.\n\nPlease format your response as follows:\n\nDocument Topic: [Brief statement of the main topic]\n\nTable of Contents:\n\nI. Introduction\n   A. [Subtopic]\n   B. [Subtopic]\n\nII. [Main Section 1]\n    A. [Subtopic]\n    B. [Subtopic]\n    C. [Subtopic]\n\nIII. [Main Section 2]\n     A. [Subtopic]\n     B. [Subtopic]\n\n[Continue with additional main sections as needed]\n\nX. Conclusion\n   A. [Summary of key points]\n   B. [Final thoughts or call to action]"}},"id":"05286533-6791-4e3a-96bc-753e4608458b","name":"Content Analyst","type":"@n8n/n8n-nodes-langchain.agent","position":[1460,360],"typeVersion":1.6}],"connections":{"Editor":{"main":[[{"node":"Create title","type":"main","index":0}]]},"Writers":{"main":[[{"node":"Merge chapters title and text","type":"main","index":0}]]},"n8n Form Trigger":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Content Analyst","type":"main","index":0}]]},"Final article text":{"main":[[{"node":"Editor","type":"main","index":0}]]},"Delegate to Writers":{"main":[[{"node":"Merge chapters title and text","type":"main","index":1},{"node":"Writers","type":"main","index":0}]]},"Merge chapters title and text":{"main":[[{"node":"Final article text","type":"main","index":0}]]},"Ollama Chat Model":{"ai_languageModel":[[{"node":"Content Analyst","type":"ai_languageModel","index":0}]]},"Create title":{"main":[[{"node":"Ghost","type":"main","index":0}]]},"Ollama Chat Model1":{"ai_languageModel":[[{"node":"Create title","type":"ai_languageModel","index":0},{"node":"Editor","type":"ai_languageModel","index":0}]]},"Ollama Chat Model3":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"AI Agent":{"main":[[{"node":"Delegate to Writers","type":"main","index":0}]]},"Ollama Chat Model4":{"ai_languageModel":[[{"node":"Writers","type":"ai_languageModel","index":0}]]},"Content Analyst":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateId":"2457"},"pinData":{},"versionId":"c7815f10-300d-4aa0-9b27-20a826e7277f","triggerCount":0,"tags":[]},{"createdAt":"2024-10-27T20:26:06.696Z","updatedAt":"2024-10-27T20:26:06.696Z","id":"Fd1QMJmlW9il3eUN","name":"Multi-Agent PDF-to-Blog Content Generation","active":false,"nodes":[{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"bde7b7db-45c6-4ab3-a705-358000cefbec","name":"Merge chapters title and text","type":"n8n-nodes-base.merge","position":[2980,360],"typeVersion":2.1},{"parameters":{"jsCode":"let article = \"\";\n\n// Introduction\narticle += $('Project Planner').first().json.message.content.introduction;\n\nfor (const item of $input.all()) {\n  article += \"<strong>\" + item.json.title + \"</strong>\";\n  article += item.json.output;\n  article += \"<br>\";\n}\n\n// Conclusions\narticle += \"<strong> Conclusions </strong>\";\narticle += $('Project Planner').first().json.message.content.conclusions;\n\n\nreturn [\n  {\n    \"article\": article\n  }\n];"},"id":"0079022b-eaa2-481b-8c78-f8623a63645b","name":"Final article text","type":"n8n-nodes-base.code","position":[3240,360],"typeVersion":1},{"parameters":{"path":"f3822072-36a2-4f5a-8fe8-ca4b513f354c","formTitle":"PDF","formFields":{"values":[{"fieldLabel":"Tone","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Professional"},{"option":"Causal"},{"option":"Witty"}]},"requiredField":true},{"fieldLabel":"Number of words","placeholder":"1000","requiredField":true},{"fieldLabel":"Number of sections","placeholder":"6","requiredField":true},{"fieldLabel":"File","fieldType":"file","multipleFiles":false,"requiredField":true}]},"options":{}},"id":"2e1c004d-43a5-4b87-9e30-beb2f22d4683","name":"n8n Form Trigger","type":"n8n-nodes-base.formTrigger","position":[1000,360],"webhookId":"f3822072-36a2-4f5a-8fe8-ca4b513f354c","typeVersion":2.1},{"parameters":{"operation":"pdf","binaryPropertyName":"File","options":{}},"id":"2246ffe9-868f-4680-9770-3bb5c8e4b2f8","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","position":[1240,360],"typeVersion":1},{"parameters":{"source":"adminApi","operation":"create","title":"={{ $json.text }}","content":"={{ $('Editor').item.json.output }}","additionalFields":{}},"id":"ef57acff-30d4-4493-bfd1-486314bd0a53","name":"Ghost","type":"n8n-nodes-base.ghost","position":[4260,360],"typeVersion":1},{"parameters":{"fieldToSplitOut":"message.content.chapters","options":{}},"id":"479f474a-1687-4588-8485-d793afc6757d","name":"Delegate to Writers","type":"n8n-nodes-base.splitOut","position":[2260,360],"typeVersion":1},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=Article to edit:\n {{ $json.article }}\n\nProvide polished output in html format. ","options":{"systemMessage":"=You are an expert Editor specializing in refining and polishing content to ensure it meets the highest quality standards. Your role is to review and improve the written material produced by the Writer. Your task is to provide an highly polished article. \n\nInstructions:\n1. Carefully read the entire content piece.\n2. Check for grammar, spelling, and punctuation errors.\n3. Ensure consistency in tone, style, and voice throughout the piece.\n4. Verify that the content aligns with the original brief and project requirements.\n5. Improve sentence structure and flow for better readability.\n6. Fact-check and verify the accuracy of information and citations.\n7. Optimize headlines, subheadings, and formatting for better engagement.\n8. Suggest improvements or additions to enhance the overall quality of the content.\n\n"}},"id":"1ba1b58e-4101-4348-b0f0-a0a92b1f4806","name":"Editor","type":"@n8n/n8n-nodes-langchain.agent","position":[3460,360],"typeVersion":1.6},{"parameters":{"content":"## Extract PDF and analyze content ⛏️\n","height":430.74703747002076,"width":524.2843893435219,"color":5},"id":"80b7a065-dc27-4109-b012-be7438ced628","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[1220,240],"typeVersion":1},{"parameters":{"model":"gpt-4o-mini","options":{}},"id":"03cc812a-d7eb-498f-8f90-821d55607f26","name":"OpenAI Chat Model2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[2540,540],"typeVersion":1},{"parameters":{"content":"## Plan the work and Delegate to writers 📅\n","height":430.74703747002076,"width":576.6288165877254,"color":5},"id":"ef96ee94-1499-43b1-baee-fb40e41818d9","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[1820,240],"typeVersion":1},{"parameters":{"content":"## Team of writers working on each chapter ✍️","height":427.13707697042037,"width":648.8280265797307,"color":5},"id":"adf103db-d4df-47f5-938e-43e4a3a87411","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[2480,240],"typeVersion":1},{"parameters":{"content":"## Editor polishing draft 📝 ","height":428.9420572202205,"width":650.6330068295307,"color":5},"id":"2e33d24b-128c-47f0-adda-024191091db2","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[3200,240],"typeVersion":1},{"parameters":{"content":"## Publish to Ghost 📰","height":428.9420572202205,"width":542.3341918415219,"color":5},"id":"48e313af-df5b-4887-8fa1-92d6de58d596","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[3900,240],"typeVersion":1},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=Write a chapter for the article: {{ $('Project Planner').item.json.message.content.title }}, {{ $('Project Planner').item.json.message.content.subtitle }}\n\nWrite the chapter titled {{ $json.title }}that {{ $json.prompt }}.\n\nDocument text as source of information to use to write the chapter:\n{{ $('Extract from File').item.json.text }}","options":{"systemMessage":"=You are a skilled writer specializing in creating engaging and informative content. Your task is to write a chapter in the blog.\n\nGuidelines:\n- Just return the plain text for each chapter (no JSON structure).\n- Use html format for output\n- Don't add internal titles or headings.\n- The length of each chapther should be around {{ Math.round($('n8n Form Trigger').item.json['Number of words'] - 120)/ $('n8n Form Trigger').item.json['Number of sections']}} words long- Go deep in the topic you treat, don't just throw some superficial info\n{{ $itemIndex > 0 ? \"- The previous chapter talks about \" + $input.all()[$itemIndex-1].json.title : \"\" }}\n{{ $itemIndex > 0 ? \"- The promt for the previous chapter is \" + $input.all()[$itemIndex-1].json.prompt : \"\" }}\n{{ $itemIndex < $input.all().length ? \"- The following chapter will talk about \" + $input.all()[$itemIndex+1].json.title: \"\" }}\n{{ $itemIndex < $input.all().length ? \"- The prompt for the following chapter is \" + $input.all()[$itemIndex+1].json.prompt : \"\" }}\n- Consider the previous and following chapters what writing the text for this chapter. The text must be coherent with the previous and following chapters.\n- This chapter should not repeat the concepts already exposed in the previous chapter.\n- This chapter is a part of a larger article so don't include an introduction or conclusions. This chapter should merge with the rest of the article.\n- Please write in a style that is {{ $('n8n Form Trigger').item.json.Tone }}\n"}},"id":"e43a0a0e-e791-4295-b7b7-d53bc87f04ec","name":"Writers","type":"@n8n/n8n-nodes-langchain.agent","position":[2560,360],"retryOnFail":true,"typeVersion":1.6},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"8a1361e8-171f-4c72-ad6e-14b2173d4df4","name":"Ollama Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[1440,540],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"promptType":"define","text":"=Suggest an engaging title based on the following article.  Please use plain text, no formating of any kind.\n {{ $json.output }}"},"id":"789c210d-6841-4c50-9057-e5fd114c0d77","name":"Create title","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[3940,360],"typeVersion":1.4},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"6b66fdcd-bf81-4818-8073-98e5f162b4f6","name":"Ollama Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[3760,640],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"You are a Content Analyst specialized in document analysis and content structuring. Your task is to analyze a given document and create a comprehensive table of contents that can serve as the basis for a blog post. Follow these steps:\n\n1. Carefully read and understand the entire document provided.\n\n2. Identify the main topic or theme of the document.\n\n3. Recognize the key points, arguments, or sections within the document.\n\n4. Organize these key elements into a logical and hierarchical structure.\n\n5. Create a table of contents with main sections and subsections that accurately reflect the document's content and flow.\n\n6. Ensure that the table of contents is suitable for a blog post format, with clear and engaging headings.\n\n7. Include a brief introduction at the beginning of the table of contents to summarize the main topic.\n\n8. Add a conclusion section at the end to wrap up the key points.\n\nPlease format your response as follows:\n\nDocument Topic: [Brief statement of the main topic]\n\nTable of Contents:\n\nI. Introduction\n   A. [Subtopic]\n   B. [Subtopic]\n\nII. [Main Section 1]\n    A. [Subtopic]\n    B. [Subtopic]\n    C. [Subtopic]\n\nIII. [Main Section 2]\n     A. [Subtopic]\n     B. [Subtopic]\n\n[Continue with additional main sections as needed]\n\nX. Conclusion\n   A. [Summary of key points]\n   B. [Final thoughts or call to action]"}},"id":"040789b8-cedf-42ed-bce7-175e7ca61caa","name":"Content Analyst","type":"@n8n/n8n-nodes-langchain.agent","position":[1460,360],"typeVersion":1.6}],"connections":{"Editor":{"main":[[{"node":"Create title","type":"main","index":0}]]},"Writers":{"main":[[{"node":"Merge chapters title and text","type":"main","index":0}]]},"n8n Form Trigger":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Content Analyst","type":"main","index":0}]]},"Final article text":{"main":[[{"node":"Editor","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Writers","type":"ai_languageModel","index":0}]]},"Delegate to Writers":{"main":[[{"node":"Merge chapters title and text","type":"main","index":1},{"node":"Writers","type":"main","index":0}]]},"Merge chapters title and text":{"main":[[{"node":"Final article text","type":"main","index":0}]]},"Ollama Chat Model":{"ai_languageModel":[[{"node":"Content Analyst","type":"ai_languageModel","index":0}]]},"Create title":{"main":[[{"node":"Ghost","type":"main","index":0}]]},"Ollama Chat Model1":{"ai_languageModel":[[{"node":"Create title","type":"ai_languageModel","index":0},{"node":"Editor","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateId":"2457"},"pinData":{},"versionId":"6e20b2a9-3814-4e64-819b-e573ef584502","triggerCount":0,"tags":[]},{"createdAt":"2024-10-26T04:46:21.725Z","updatedAt":"2024-10-30T10:20:32.889Z","id":"pGcek1JF1kaGkeNw","name":"AI-Workflow","active":false,"nodes":[{"parameters":{"contextWindowLength":3},"id":"1f6067c6-436d-4b52-934c-86b68bcbf238","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.1,"position":[1040,560],"credentials":{"postgres":{"id":"ZijF8dvwIpPvDwHf","name":"Postgres account"}}},{"parameters":{"model":"llama3.1:latest","options":{"temperature":0.7,"topK":40,"topP":0.9,"numCtx":4096}},"id":"85a33c7b-8eb0-4289-b196-3eb96c08430f","name":"Ollama Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[920,560],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"3ffe428c-4d15-4a17-97cf-c1342afb8ec0","name":"Ollama Model","type":"@n8n/n8n-nodes-langchain.lmOllama","typeVersion":1,"position":[1960,520],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"name":"documents","topK":3},"id":"2ce66131-82a1-4c88-8073-eceddbe75edd","name":"Vector Store Tool","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[1740,340]},{"parameters":{"model":"nomic-embed-text:latest"},"id":"56d5d311-1d1c-427c-81c9-fe2a55f71118","name":"Embeddings Ollama","type":"@n8n/n8n-nodes-langchain.embeddingsOllama","typeVersion":1,"position":[1840,600],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"13dF0sIX4TEstFh5obW_mldkdDFpYhDoD","mode":"list","cachedResultName":"AI-workflow","cachedResultUrl":"https://drive.google.com/drive/folders/13dF0sIX4TEstFh5obW_mldkdDFpYhDoD"},"event":"fileCreated","options":{}},"id":"a4fe8197-d4e8-46d7-b5f6-87981278215c","name":"File Created","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[600,880],"credentials":{"googleDriveOAuth2Api":{"id":"CcpMlhvr4q1nChLx","name":"Google Drive account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"13dF0sIX4TEstFh5obW_mldkdDFpYhDoD","mode":"list","cachedResultName":"AI-workflow","cachedResultUrl":"https://drive.google.com/drive/folders/13dF0sIX4TEstFh5obW_mldkdDFpYhDoD"},"event":"fileUpdated","options":{}},"id":"94fc973f-b3b8-42df-90de-c1a9fa362cda","name":"File Updated","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[600,1040],"credentials":{"googleDriveOAuth2Api":{"id":"CcpMlhvr4q1nChLx","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"file_id","value":"={{ $json.id }}","type":"string"},{"id":"dd0aa081-79e7-4714-8a67-1e898285554c","name":"folder_id","value":"={{ $json.parents[0] }}","type":"string"}]},"options":{}},"id":"f2b4cdcf-1484-4f88-962b-73a22eda6773","name":"Set File ID","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[780,880]},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Set File ID').item.json.file_id }}","mode":"id"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"text/plain"}}}},"id":"a23fc37a-7da9-45e6-93f6-be0193f8ea38","name":"Download File","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1080,880],"executeOnce":true,"credentials":{"googleDriveOAuth2Api":{"id":"CcpMlhvr4q1nChLx","name":"Google Drive account"}}},{"parameters":{"operation":"text","options":{}},"id":"969ab35d-71a8-43ce-b157-43860efab41f","name":"Extract Document Text","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[1300,880],"alwaysOutputData":true},{"parameters":{"options":{"metadata":{"metadataValues":[{"name":"file_id","value":"={{ $('Set File ID').item.json.file_id }}"},{"name":"folder_id","value":"={{ $('Set File ID').item.json.folder_id }}"}]}}},"id":"becda897-21df-4e98-b11d-fc2a3a52baf6","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[1860,1100]},{"parameters":{"chunkSize":100,"options":{}},"id":"9b69499a-bfaf-4d13-a070-b6c3a938f377","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[2000,1240]},{"parameters":{"model":"nomic-embed-text:latest"},"id":"2e831c31-c660-4c29-9359-05aca0c04c80","name":"Embeddings Ollama1","type":"@n8n/n8n-nodes-langchain.embeddingsOllama","typeVersion":1,"position":[1700,1100],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"content":"## Local RAG AI Agent with Chat Interface","height":527.3027193303974,"width":969.0343804425795},"id":"a5fcd009-e861-43b4-8ec0-25ea4597b750","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[560,220]},{"parameters":{"content":"## Agent Tools for Local RAG","height":528.85546469693,"width":583.4552380860637,"color":4},"id":"f3d6da31-a86b-41af-a143-c9f4f4053bee","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1540,220]},{"parameters":{"content":"## Workflow to Create Local Knowledgebase from Google Drive Folder","height":705.2695614889159,"width":1568.9362829025763,"color":5},"id":"1ee75bfe-645b-4912-830b-1b74bc902a56","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[560,760]},{"parameters":{"code":{"execute":{"code":"const { QdrantVectorStore } = require(\"@langchain/qdrant\");\nconst { OllamaEmbeddings } = require(\"@langchain/community/embeddings/ollama\");\n\nconst embeddings = new OllamaEmbeddings({\n  model: \"nomic-embed-text\",\n  baseUrl: \"http://ollama:11434\"\n});\n\nconst vectorStore = await QdrantVectorStore.fromExistingCollection(\n  embeddings,\n  {\n    url: \"http://qdrant:6333\",\n    collectionName: \"documents\",\n  }\n);\n\nconst fileIdToDelete = this.getInputData()[0].json.file_id;\n\nconst filter = {\n        must: [\n            {\n                key: \"metadata.file_id\",\n                match: {\n                    value: fileIdToDelete,\n                },\n            },\n        ],\n    }\n\n// const results = await vectorStore.similaritySearch(\"this\", 10, filter);\n// const idsToDelete = results.map((doc) => doc.id);\n\n// NOT IMPLEMENTED!\n// await vectorStore.delete({ ids: idsToDelete });\n\nvectorStore.client.delete(\"documents\", {\n  filter\n});\n\nreturn [ {json: { file_id: fileIdToDelete } } ];\n"}},"inputs":{"input":[{"type":"main","required":true}]},"outputs":{"output":[{"type":"main"}]}},"id":"702f66aa-954b-407c-ab42-6b935520bc70","name":"Clear Old Vectors","type":"@n8n/n8n-nodes-langchain.code","typeVersion":1,"position":[920,880],"alwaysOutputData":false},{"parameters":{"options":{}},"id":"6a5aeed6-ad17-40ec-8075-0fbbcb11600f","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1340,340]},{"parameters":{"assignments":{"assignments":[{"id":"75ebfdef-c8e2-4c3e-b716-1479d0cc2a73","name":"chatInput","value":"={{ $json?.chatInput || $json.body.chatInput }}","type":"string"},{"id":"59b7a20f-0626-4861-93e2-015d430c266e","name":"sessionId","value":"={{ $json?.sessionId || $json.body.sessionId}}","type":"string"}]},"options":{}},"id":"9a8333ae-0663-4b58-b891-f8ca86c5f7dd","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[820,340]},{"parameters":{"qdrantCollection":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"id":"b2817c3e-36a5-44c6-8b58-d0e018a23c21","name":"Qdrant Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1,"position":[1560,480],"credentials":{"qdrantApi":{"id":"dcQ0XmPJ7YxMdsR8","name":"QdrantApi account"}}},{"parameters":{"jsCode":"// Code node content\nconst results = [];\n\n// Function to split text into chunks\nfunction splitText(text, chunkSize = 1000, overlap = 100) {\n    const chunks = [];\n    let index = 0;\n    \n    while (index < text.length) {\n        chunks.push(text.slice(index, index + chunkSize));\n        index += (chunkSize - overlap);\n    }\n    \n    return chunks;\n}\n\nfor (const item of items) {\n    // Correctly access the binary data\n    const binaryContent = item.binary.data.data;\n    const fileName = item.binary.data.fileName;\n    \n    if (!binaryContent) {\n        console.log('No binary content found');\n        continue;\n    }\n    \n    // Convert binary data to text\n    const text = Buffer.from(binaryContent, 'base64').toString('utf-8');\n    \n    // Split the text into chunks\n    const textChunks = splitText(text);\n    \n    // Create an item for each chunk\n    textChunks.forEach((chunk, index) => {\n        results.push({\n            json: {\n                chunk: chunk,\n                chunkIndex: index,\n                totalChunks: textChunks.length,\n                fileId: item.json.file_id,\n                fileName: fileName,\n                isLastChunk: index === textChunks.length - 1\n            }\n        });\n    });\n}\n\nreturn results;"},"id":"fa509435-8b81-4102-bf63-88b424d03978","name":"Code","type":"n8n-nodes-base.code","typeVersion":2,"position":[1300,1760]},{"parameters":{"batchSize":5,"options":{}},"id":"68937154-2892-46ff-87e9-53b27c3126aa","name":"Loop Over Items","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1540,1680]},{"parameters":{"options":{}},"id":"008b8532-7fe9-4b94-8ed3-8e7a65b3aa61","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[620,340],"webhookId":"b4b0ec5a-aa56-4bf8-8d6b-deb2b304e06f"},{"parameters":{"httpMethod":"POST","path":"invoke_n8n_agent","responseMode":"responseNode","options":{}},"id":"fd03774f-8a43-470e-9c0d-c060e2981dce","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[620,520],"webhookId":"229c5e4a-f195-4d85-bfd3-ec7cc5642e0d"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5382be65-20a4-4e9a-90cc-0e0877cf0bd1","leftValue":"={{ $json.data.length }}","rightValue":3000,"operator":{"type":"number","operation":"lt"}}],"combinator":"and"},"options":{}},"id":"df1bbcfd-8d43-41cb-84ae-a40faaa2f31c","name":"If","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1040,1580]},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"chunk","renameField":true,"outputFieldName":"data"}]},"options":{}},"id":"828f4d17-4201-4a7b-95c2-f9a469959782","name":"Aggregate","type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1320,1580]},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"id":"04930ac5-061e-4645-ba3a-82f18832a7f8","name":"Qdrant Vector Store Insert","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1,"position":[1760,880],"credentials":{"qdrantApi":{"id":"dcQ0XmPJ7YxMdsR8","name":"QdrantApi account"}}},{"parameters":{"jsCode":"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  item.json.myNewField = 1;\n}\n\nreturn $input.all();"},"id":"bd91ebc0-9494-4827-a05a-8451790ac242","name":"Code1","type":"n8n-nodes-base.code","typeVersion":2,"position":[1480,340]},{"parameters":{"options":{"systemMessage":"You are a local RAG-enhanced AI assistant. Your role is to:\n- Provide accurate responses using the context from the vector store\n- Admit when you don't have enough information to answer\n- Keep responses focused and relevant to the retrieved context\n- Format responses in a clear, structured manner\n- Ask for clarification when user queries are ambiguous\n- Never make up information not present in the retrieved documents\n- Cite specific sources from the knowledge base when possible"}},"id":"c9d0d826-ba20-457f-8359-4d40234970c8","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[1000,340]}],"connections":{"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Ollama Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Ollama Model":{"ai_languageModel":[[{"node":"Vector Store Tool","type":"ai_languageModel","index":0}]]},"Embeddings Ollama":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"File Created":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"File Updated":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"Set File ID":{"main":[[{"node":"Clear Old Vectors","type":"main","index":0}]]},"Download File":{"main":[[{"node":"Extract Document Text","type":"main","index":0}]]},"Extract Document Text":{"main":[[{"node":"Qdrant Vector Store Insert","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store Insert","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings Ollama1":{"ai_embedding":[[{"node":"Qdrant Vector Store Insert","type":"ai_embedding","index":0}]]},"Clear Old Vectors":{"main":[[{"node":"Download File","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Vector Store Tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Vector Store Tool","type":"ai_vectorStore","index":0}]]},"Code":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Aggregate","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"If":{"main":[[],[{"node":"Code","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0},{"node":"Code1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:File Created":{"lastTimeChecked":"2024-10-29T11:05:32Z"},"node:File Updated":{"lastTimeChecked":"2024-10-29T11:05:33Z"}},"meta":{"templateCredsSetupCompleted":true,"instanceId":"3a5745a05f87ddee1db68b217dc043bfa206d1c7aaa1dd0a7dd76b852a733597"},"pinData":{},"versionId":"05312a8f-7b46-4b1a-9e28-9498e81fca03","triggerCount":5,"tags":[]},{"createdAt":"2024-10-27T20:37:50.319Z","updatedAt":"2024-10-30T09:16:28.069Z","id":"wpZTj8aCiTX4K0AZ","name":"Flux AI Image Generator","active":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"9ec60f33-b940-40a6-9f8a-cb944b7065f1","name":"stylePrompt","type":"string","value":"=rule of thirds, golden ratio, hyper-maximalist, vibrant neon, high-contrast, octane render, photorealism, 8k ::7 --ar 16:9 --s 1000\n\nDesign a fun, energetic scene filled with bold, neon colors, and playful shapes that pop off the screen. The image should evoke a sense of joy and movement, using fluid, organic forms and exaggerated, cartoon-like proportions. Focus on creating a lively atmosphere with contrasting, saturated tones and dynamic lighting. Use a mix of asymmetrical and balanced compositions to create a playful visual flow. Render in 8K with a hyper-maximalist approach using Octane Render for vibrant, high-gloss textures and photorealistic lighting effects. Include:"}]},"includeOtherFields":true,"options":{}},"id":"6abe578b-d503-4da5-9af8-f9977de71139","name":"Vivid Pop Explosion","type":"n8n-nodes-base.set","position":[380,980],"notesInFlow":true,"typeVersion":3.4,"notes":" "},{"parameters":{"assignments":{"assignments":[{"id":"9ec60f33-b940-40a6-9f8a-cb944b7065f1","name":"stylePrompt","type":"string","value":"=golden ratio, rule of thirds, cyberpunk, glitch art, octane render, cinematic realism, 8k ::7 --ar 16:9 --s 1000\n\nGenerate a futuristic, cyberpunk dystopia with metallic textures, digital glitches, and neon lights. Blend cold, dystopian structures with traces of organic life. Use photorealistic lighting and dynamic reflections to enhance the visual depth of the scene. Include:"}]},"includeOtherFields":true,"options":{}},"id":"7de1ea42-3b18-4bfb-8ea4-a8b6c8d16763","name":"AI Dystopia","type":"n8n-nodes-base.set","position":[380,620],"notesInFlow":true,"typeVersion":3.4,"notes":" "},{"parameters":{"assignments":{"assignments":[{"id":"9ec60f33-b940-40a6-9f8a-cb944b7065f1","name":"stylePrompt","type":"string","value":"=rule of thirds, asymmetric composition, glitch art, pixelation, VHS noise, octane render, unreal engine, 8k ::7 --ar 16:9 --s 1200\nDesign a glitchy, post-analog world with digital decay and broken visuals. Utilize pixelated elements, VHS noise, and neon glitches to create a fragmented aesthetic. Use bold, contrasting colors against muted backgrounds for a high-contrast, otherworldly feel. The composition should follow asymmetrical rules, focusing on chaotic yet intentional visual balance. Include:"}]},"includeOtherFields":true,"options":{}},"id":"aa17c288-78e0-48d9-9c60-0e63e351d0b6","name":"Post-Analog Glitchscape","type":"n8n-nodes-base.set","position":[380,420],"notesInFlow":true,"typeVersion":3.4,"notes":" "},{"parameters":{"assignments":{"assignments":[{"id":"9ec60f33-b940-40a6-9f8a-cb944b7065f1","name":"stylePrompt","type":"string","value":"=asymmetric composition, golden ratio, neon colors, abstract forms, octane render, cinematic realism, unreal engine, 8k ::7 --ar 16:9 --s 1000\nCreate a bold, vivid composition using neon colors and fluid shapes that break away from reality. Focus on abstract forms, blending Fauvism's exaggerated color palette with modern digital art techniques. Use asymmetric composition and dynamic lighting. Render with a vibrant, high-energy aesthetic. Include:"}]},"includeOtherFields":true,"options":{}},"id":"769ff46c-630f-456d-ae19-4c6496270fda","name":"Neon Fauvism","type":"n8n-nodes-base.set","position":[380,800],"notesInFlow":true,"typeVersion":3.4,"notes":" "},{"parameters":{"assignments":{"assignments":[{"id":"9ec60f33-b940-40a6-9f8a-cb944b7065f1","name":"stylePrompt","type":"string","value":"=Include: "}]},"includeOtherFields":true,"options":{}},"id":"ccc67dcb-84e6-476a-9bc2-b5382b700d5e","name":"None","type":"n8n-nodes-base.set","position":[380,1160],"notesInFlow":true,"typeVersion":3.4,"notes":" "},{"parameters":{"respondWith":"text","responseBody":"=<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Flux Image Generation Result</title>\n    <style>\n        body {\n            font-family: 'Open Sans', Tahoma, Geneva, Verdana, sans-serif;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 100vh;\n            background-color: #121212;\n            color: #e0e0e0;\n        }\n        .container {\n            margin-top: 2em;\n            width: 90%;\n            max-width: 670px; /* Increased the max-width for the main image area */\n            text-align: center;\n            background: #1e1e1e;\n            padding: 24px;\n            border-radius: 12px;\n            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);\n            margin-bottom: 24px;\n        }\n        .image-container {\n            margin-bottom: 20px;\n        }\n        .image-container img {\n            max-width: 100%;\n            height: auto;\n            border-radius: 12px;\n            border: 2px solid #333;\n        }\n        .style-text {\n            font-size: 18px;\n            margin-bottom: 20px;\n            color: #bbb;\n        }\n        .cta {\n            display: block;\n            width: 100%;\n            margin: 20px 0 0;\n            padding: 18px 0;\n            border: none;\n            border-radius: 6px;\n            text-decoration: none;\n            color: #fff;\n            background-color: #1C9985;\n            font-size: 18px;\n            font-weight: 400;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n        .cta:hover {\n            background-color: #20B69E;\n            transform: translateY(-2px);\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n        }\n        /* New section for recent renders */\n        .recent-renders {\n            display: flex;\n            justify-content: space-between;\n            flex-wrap: wrap;\n            gap: 16px;\n            margin-top: 24px;\n            max-width: 670px;\n        }\n        .recent-render img {\n            width: 100%;\n            max-width: 180px;\n            height: auto;\n            border-radius: 8px;\n            border: 2px solid #333;\n        }\n        .recent-render {\n            flex: 1;\n            max-width: 200px;\n            background-color: #2c2c2c;\n            padding: 10px;\n            border-radius: 10px;\n            margin-bottom: 3 rem;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"image-container\">\n            <img src=\"https://pub-d2d94462851644a78ea607e05f8a2d25.r2.dev/fg-{{ $execution.id }}.jpg\" alt=\"Generated Image\" />\n        </div>\n        <div class=\"style-text\">Style: {{ $('Route by style').item.json.Style }}</div>\n        <a href=\"https://n8n.io/workflows/2417-flux-ai-image-generator?utm_source=30day\" class=\"cta\">Duplicate this AI template</a>\n    </div>\n    \n    <!-- New section to display the last 4 renders -->\n    <div class=\"recent-renders\">\n        <div class=\"recent-render\">\n            <img src=\"https://pub-d2d94462851644a78ea607e05f8a2d25.r2.dev/fg-{{ $execution.id.toNumber() - 1 }}.jpg\" alt=\"Recent Render 1\">\n        </div>\n        <div class=\"recent-render\">\n            <img src=\"https://pub-d2d94462851644a78ea607e05f8a2d25.r2.dev/fg-{{ $execution.id.toNumber() - 2 }}.jpg\" alt=\"Recent Render 2\">\n        </div>\n        <div class=\"recent-render\">\n            <img src=\"https://pub-d2d94462851644a78ea607e05f8a2d25.r2.dev/fg-{{ $execution.id .toNumber() - 3}}.jpg\" alt=\"Recent Render 3\">\n        </div>\n        <div class=\"recent-render\">\n            <img src=\"https://pub-d2d94462851644a78ea607e05f8a2d25.r2.dev/fg-{{ $execution.id.toNumber() - 4 }}.jpg\">\n        </div>\n    </div>\n</body>\n</html>\n","options":{}},"id":"fea2039c-48e5-4077-af2c-ea72838e1a5d","name":"Serve webpage","type":"n8n-nodes-base.respondToWebhook","position":[1460,580],"typeVersion":1.1},{"parameters":{"respondWith":"json","responseBody":"{\n  \"formSubmittedText\": \"Flux API failed. It does this ~10% of the time. Refresh and try again.\"\n}","options":{}},"id":"2df7b738-9584-48b4-8adc-cafb0c026928","name":"Respond with error","type":"n8n-nodes-base.respondToWebhook","position":[1460,820],"typeVersion":1.1},{"parameters":{"content":"### Set style prompt\nEach Edit fields node after the Switch sets `stylePrompt`, used in huggingface node.","height":107.99633347519193,"width":205.9419250888625,"color":7},"id":"54cba7c4-db24-4abb-9638-ee66236d8676","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-20,440],"typeVersion":1},{"parameters":{"content":"### Run flux model\nIn `Call huggingface inference api` You can change `black-forest-labs/FLUX.1-schnell` in URL parameter to other models:\n- `black-forest-labs/FLUX.1-dev`\n- `Shakker-Labs/FLUX.1-dev-LoRA-AntiBlur`\n- `XLabs-AI/flux-RealismLora`\n- `ByteDance/Hyper-SD`\n\n[See more models on huggingface.co](https://huggingface.co/models?pipeline_tag=text-to-image&sort=trending)\n","height":226.2264013670822,"width":419.0156901664085,"color":7},"id":"f4aa76f8-d35f-4332-aa39-0c34582618eb","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[720,840],"typeVersion":1},{"parameters":{"content":"### Host image on S3\n[Cloudflare](https://cloudflare.com) has free S3 compatible hosting. They call it \"R2\".","height":90.99855957953969,"width":247.37323750873333,"color":7},"id":"2b0b29ce-82c2-4428-bf12-cb25262e5291","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[1120,440],"typeVersion":1},{"parameters":{"operation":"upload","bucketName":"flux-generator","fileName":"=fg-{{ $execution.id }}.jpg","additionalFields":{}},"id":"6fccc88f-9e72-49a3-952d-b7b1d9612091","name":"Upload image to S3","type":"n8n-nodes-base.s3","position":[1120,580],"typeVersion":1,"onError":"continueErrorOutput"},{"parameters":{"content":"### Respond to Form\nServe a webform with image on success. On error, send message to form.","height":90.99855957953969,"width":302.9292231993488,"color":7},"id":"7824dc49-c546-424e-8ba9-5f34b190d5f0","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[1460,440],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"9ec60f33-b940-40a6-9f8a-cb944b7065f1","name":"stylePrompt","type":"string","value":"=golden ratio, rule of thirds, cyberpunk, glitch art, octane render, cinematic realism, 8k ::7 --ar 16:9 --s 1000\nCreate a hyper-realistic yet surreal landscape that bends reality, incorporating dreamlike elements and exaggerated proportions. Use vibrant, almost neon colors, and focus on a sense of wonder, play, and fantasy. Include:\n"}]},"includeOtherFields":true,"options":{}},"id":"71739ba4-b8db-439e-b8c3-06f3208126e3","name":"Hyper-Surreal Escape","type":"n8n-nodes-base.set","position":[380,240],"notesInFlow":true,"typeVersion":3.4,"notes":" "},{"parameters":{"content":"### Serve form to user\nCaptures `Prompt to flux` and `Style` from user.","height":103.99685726445023,"width":186.9444130878394,"color":7},"id":"dcfdb152-a055-4f0f-baa5-7cf8afba36ae","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[-320,440],"typeVersion":1},{"parameters":{"path":"flux4free","formTitle":"flux.schnell image generator","formDescription":"No ads, no BS. Uses hugginface inference API.","formFields":{"values":[{"fieldLabel":"Prompt to flux","fieldType":"textarea","placeholder":" An astronaut riding a horse in 35mm style","requiredField":true},{"fieldLabel":"Style","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Hyper-Surreal Escape"},{"option":"Neon Fauvism"},{"option":"Post-Analog Glitchscape"},{"option":"AI Dystopia"},{"option":"Vivid Pop Explosion"}]}}]},"responseMode":"responseNode","options":{}},"id":"310f6c63-9441-4332-82dc-09b56e4f625a","name":"n8n Form Trigger","type":"n8n-nodes-base.formTrigger","position":[-280,660],"webhookId":"a35eb005-f795-4c85-9d00-0fe9797cb509","typeVersion":2.1},{"parameters":{"method":"POST","url":"https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"inputs","value":"=Depict {{ $json['Prompt to flux'] }}\n\nStyle: {{ $json.stylePrompt }}"}]},"options":{}},"id":"ad10a84f-851a-40f8-b10e-18356c4eeed6","name":"Call hugginface inference api","type":"n8n-nodes-base.httpRequest","position":[740,660],"notesInFlow":true,"typeVersion":4.2,"onError":"continueErrorOutput","notes":" "},{"parameters":{"content":"### Watch Set Up Video 👇\n[![Flux Generator](https://uploads.n8n.io/devrel/fluxgenerator.png#full-width)](https://youtu.be/Rv_1jt5WvtY)\n\n","height":337.24177957113216,"width":506.8102696237577,"color":7},"id":"e740dd3c-e23e-485b-bb4c-bb0515897a08","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-880,600],"typeVersion":1},{"parameters":{"content":"# flux image generator\nBuilt by [@maxtkacz](https://x.com/maxtkacz) as part of the [30 Day AI Sprint](https://30dayaisprint.notion.site/)\nCheck out the project's [Notion page](https://30dayaisprint.notion.site/Flux-image-generator-bc94a8d2de8447c6ab70aacf2c4179f2) for more details","height":134.27496896630808,"width":506.8102696237577,"color":7},"id":"71d01821-3e0d-4c08-8571-58a158817e2c","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-880,440],"typeVersion":1},{"parameters":{"rules":{"values":[{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.Style }}","rightValue":"Hyper-Surreal Escape"}]},"renameOutput":true,"outputKey":"Hyper-Surreal Escape"},{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"106969fa-994c-4b1e-b693-fc0b48ce5f3d","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.Style }}","rightValue":"Post-Analog Glitchscape"}]},"renameOutput":true,"outputKey":"Post-Analog Glitchscape"},{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"24318e7d-4dc1-4369-b045-bb7d0a484def","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.Style }}","rightValue":"AI Dystopia"}]},"renameOutput":true,"outputKey":"AI Dystopia"},{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"a80911ff-67fc-416d-b135-0401c336d6d8","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.Style }}","rightValue":"Neon Fauvism"}]},"renameOutput":true,"outputKey":"Neon Fauvism"},{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"7fdeec28-194e-415e-8da2-8bac90e4c011","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.Style }}","rightValue":"Vivid Pop Explosion"}]},"renameOutput":true,"outputKey":"Vivid Pop Explosion"}]},"options":{"fallbackOutput":"extra"}},"id":"0cc26680-ba63-464f-ba84-68c2616f95e2","name":"Route by style","type":"n8n-nodes-base.switch","position":[0,640],"typeVersion":3.1}],"connections":{"None":{"main":[[{"node":"Call hugginface inference api","type":"main","index":0}]]},"AI Dystopia":{"main":[[{"node":"Call hugginface inference api","type":"main","index":0}]]},"Neon Fauvism":{"main":[[{"node":"Call hugginface inference api","type":"main","index":0}]]},"Route by style":{"main":[[{"node":"Hyper-Surreal Escape","type":"main","index":0}],[{"node":"Post-Analog Glitchscape","type":"main","index":0}],[{"node":"AI Dystopia","type":"main","index":0}],[{"node":"Neon Fauvism","type":"main","index":0}],[{"node":"Vivid Pop Explosion","type":"main","index":0}],[{"node":"None","type":"main","index":0}]]},"n8n Form Trigger":{"main":[[{"node":"Route by style","type":"main","index":0}]]},"Upload image to S3":{"main":[[{"node":"Serve webpage","type":"main","index":0}],[{"node":"Respond with error","type":"main","index":0}]]},"Vivid Pop Explosion":{"main":[[{"node":"Call hugginface inference api","type":"main","index":0}]]},"Hyper-Surreal Escape":{"main":[[{"node":"Call hugginface inference api","type":"main","index":0}]]},"Post-Analog Glitchscape":{"main":[[{"node":"Call hugginface inference api","type":"main","index":0}]]},"Call hugginface inference api":{"main":[[{"node":"Upload image to S3","type":"main","index":0}],[{"node":"Respond with error","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateId":"2417","instanceId":"3a5745a05f87ddee1db68b217dc043bfa206d1c7aaa1dd0a7dd76b852a733597"},"pinData":{},"versionId":"88527e49-547c-46ea-97b8-14367de232b9","triggerCount":0,"tags":[]},{"createdAt":"2024-10-27T00:54:48.166Z","updatedAt":"2024-10-30T09:16:28.069Z","id":"vTN9y2dLXqTiDfPT","name":"Local RAG AI Agent","active":false,"nodes":[{"parameters":{},"id":"99b30fd7-b36c-44ba-9daa-408585aaaee9","name":"Postgres Chat Memory","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.1,"position":[1040,560],"credentials":{"postgres":{"id":"ZijF8dvwIpPvDwHf","name":"Postgres account"}}},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"c7632a7c-2661-492e-bd6f-aab994818998","name":"Ollama Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[920,560],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"model":"llama3.1:latest","options":{}},"id":"73d773a4-5c72-4af3-a52d-144f0e417823","name":"Ollama Model","type":"@n8n/n8n-nodes-langchain.lmOllama","typeVersion":1,"position":[1960,500],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"name":"documents","topK":3},"id":"3f882fa7-c8ed-4531-b236-a34c16c55838","name":"Vector Store Tool","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[1740,340]},{"parameters":{"model":"nomic-embed-text:latest"},"id":"3a8e3fa0-3997-4bce-985c-975fb5ad4013","name":"Embeddings Ollama","type":"@n8n/n8n-nodes-langchain.embeddingsOllama","typeVersion":1,"position":[1840,600],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1914m3M7kRzkd5RJqAfzRY9EBcJrKemZC","mode":"list","cachedResultName":"Meeting Notes","cachedResultUrl":"https://drive.google.com/drive/folders/1914m3M7kRzkd5RJqAfzRY9EBcJrKemZC"},"event":"fileCreated","options":{}},"id":"41fb71dd-236a-48bc-9761-5841d52ca1b3","name":"File Created","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[600,880],"credentials":{"googleDriveOAuth2Api":{"id":"CcpMlhvr4q1nChLx","name":"Google Drive account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1914m3M7kRzkd5RJqAfzRY9EBcJrKemZC","mode":"list","cachedResultName":"Meeting Notes","cachedResultUrl":"https://drive.google.com/drive/folders/1914m3M7kRzkd5RJqAfzRY9EBcJrKemZC"},"event":"fileUpdated","options":{}},"id":"7b904686-89ae-4722-9ce5-a9da1b13b1a1","name":"File Updated","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[600,1100],"credentials":{"googleDriveOAuth2Api":{"id":"CcpMlhvr4q1nChLx","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"file_id","value":"={{ $json.id }}","type":"string"},{"id":"dd0aa081-79e7-4714-8a67-1e898285554c","name":"folder_id","value":"={{ $json.parents[0] }}","type":"string"}]},"options":{}},"id":"87f8bbb0-92c5-4b25-be63-7a9d91fc46f8","name":"Set File ID","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[860,880]},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Set File ID').item.json.file_id }}","mode":"id"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"text/plain"}}}},"id":"9f1e08fb-4ef3-4c4d-9473-5a7a1608b8e3","name":"Download File","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1300,880],"executeOnce":true,"credentials":{"googleDriveOAuth2Api":{"id":"CcpMlhvr4q1nChLx","name":"Google Drive account"}}},{"parameters":{"operation":"text","options":{}},"id":"7efee822-68ad-4fe2-a616-ba19fd127684","name":"Extract Document Text","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[1540,880],"alwaysOutputData":true},{"parameters":{"options":{"metadata":{"metadataValues":[{"name":"file_id","value":"={{ $('Set File ID').item.json.file_id }}"},{"name":"folder_id","value":"={{ $('Set File ID').item.json.folder_id }}"}]}}},"id":"da4c8b29-4944-43c4-9df3-e380366c594a","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[1860,1100]},{"parameters":{"chunkSize":100,"options":{}},"id":"d11c39b9-3fa7-4d5d-838f-da0d258c67c5","name":"Recursive Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[1860,1320]},{"parameters":{"model":"nomic-embed-text:latest"},"id":"8a04559c-dfe8-479f-8998-a2e9bc994a0a","name":"Embeddings Ollama1","type":"@n8n/n8n-nodes-langchain.embeddingsOllama","typeVersion":1,"position":[1700,1100],"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"content":"## Local RAG AI Agent with Chat Interface","height":527.3027193303974,"width":969.0343804425795},"id":"a18773ae-1eb3-46b8-91cf-4184c66cf14f","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[560,220]},{"parameters":{"content":"## Agent Tools for Local RAG","height":528.85546469693,"width":583.4552380860637,"color":4},"id":"fa010a11-3dda-4bd5-b261-463a3a6b88d9","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1540,220]},{"parameters":{"content":"## Workflow to Create Local Knowledgebase from Google Drive Folder","height":705.2695614889159,"width":1568.9362829025763,"color":5},"id":"f29e6cc7-015e-47cb-a4fd-fecd6ffb0d24","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[560,760]},{"parameters":{"options":{}},"id":"5da52326-dfbd-4350-919c-843461f58913","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[620,340],"webhookId":"4b3b1838-d6b3-447e-9d79-d0931eddb9f8"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"id":"355370e0-2174-4e5b-830b-dd0f123b2e40","name":"Qdrant Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1,"position":[1560,480],"credentials":{"qdrantApi":{"id":"dcQ0XmPJ7YxMdsR8","name":"QdrantApi account"}}},{"parameters":{"code":{"execute":{"code":"const { QdrantVectorStore } = require(\"@langchain/qdrant\");\nconst { OllamaEmbeddings } = require(\"@langchain/community/embeddings/ollama\");\n\nconst embeddings = new OllamaEmbeddings({\n  model: \"nomic-embed-text\",\n  baseUrl: \"http://ollama:11434\"\n});\n\nconst vectorStore = await QdrantVectorStore.fromExistingCollection(\n  embeddings,\n  {\n    url: \"http://qdrant:6333\",\n    collectionName: \"documents\",\n  }\n);\n\nconst fileIdToDelete = this.getInputData()[0].json.file_id;\n\nconst filter = {\n        must: [\n            {\n                key: \"metadata.file_id\",\n                match: {\n                    value: fileIdToDelete,\n                },\n            },\n        ],\n    }\n\n// const results = await vectorStore.similaritySearch(\"this\", 10, filter);\n// const idsToDelete = results.map((doc) => doc.id);\n\n// NOT IMPLEMENTED!\n// await vectorStore.delete({ ids: idsToDelete });\n\nvectorStore.client.delete(\"documents\", {\n  filter\n});\n\nreturn [ {json: { file_id: fileIdToDelete } } ];\n"}},"inputs":{"input":[{"type":"main","required":true}]},"outputs":{"output":[{"type":"main"}]}},"id":"b93bd001-0c4d-42fe-939a-eb441f354917","name":"Clear Old Vectors","type":"@n8n/n8n-nodes-langchain.code","typeVersion":1,"position":[1080,880],"alwaysOutputData":false},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"id":"97ec4618-c0ea-445b-9406-5d41784d7836","name":"Qdrant Vector Store Insert","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1,"position":[1760,880],"credentials":{"qdrantApi":{"id":"dcQ0XmPJ7YxMdsR8","name":"QdrantApi account"}}},{"parameters":{"options":{}},"id":"e537544a-37d5-4b00-b5ff-bc71f041f4bb","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[1340,340]},{"parameters":{"httpMethod":"POST","path":"invoke_n8n_agent","responseMode":"responseNode","options":{}},"id":"2b8cd01f-30a8-4aab-b0dd-56d2b658f059","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[620,520],"webhookId":"4a839da9-b8a2-45f8-bcaf-c484f9a5912d"},{"parameters":{"options":{}},"id":"c9dfe906-178b-4375-8bda-f9290f35f222","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[1000,340]},{"parameters":{"assignments":{"assignments":[{"id":"75ebfdef-c8e2-4c3e-b716-1479d0cc2a73","name":"chatInput","value":"={{ $json?.chatInput || $json.body.chatInput }}","type":"string"},{"id":"59b7a20f-0626-4861-93e2-015d430c266e","name":"sessionId","value":"={{ $json?.sessionId || $json.body.sessionId}}","type":"string"}]},"options":{}},"id":"8f974a15-aa2f-4525-8278-ad58ad296076","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[820,340]}],"connections":{"Postgres Chat Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Ollama Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Ollama Model":{"ai_languageModel":[[{"node":"Vector Store Tool","type":"ai_languageModel","index":0}]]},"Embeddings Ollama":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"File Created":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"File Updated":{"main":[[{"node":"Set File ID","type":"main","index":0}]]},"Set File ID":{"main":[[{"node":"Clear Old Vectors","type":"main","index":0}]]},"Download File":{"main":[[{"node":"Extract Document Text","type":"main","index":0}]]},"Extract Document Text":{"main":[[{"node":"Qdrant Vector Store Insert","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store Insert","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings Ollama1":{"ai_embedding":[[{"node":"Qdrant Vector Store Insert","type":"ai_embedding","index":0}]]},"When chat message received":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Vector Store Tool","type":"ai_vectorStore","index":0}]]},"Clear Old Vectors":{"main":[[{"node":"Download File","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Vector Store Tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true,"instanceId":"f722e3e1e81e942a38faa434ad0aee8699371bbff9f883b9d5c59a7c726605af"},"pinData":{},"versionId":"19f9691c-4682-4704-81f2-33fdec9d0be2","triggerCount":0,"tags":[]},{"createdAt":"2024-10-27T20:38:47.924Z","updatedAt":"2024-10-30T09:16:28.069Z","id":"qZ33rJTWhBcQKiDC","name":"Auto Categorise Outlook Emails with AI","active":false,"nodes":[{"parameters":{},"id":"30f5203b-469d-4f0c-8493-e8f08e14e4fe","name":"When clicking ‘Test workflow’","type":"n8n-nodes-base.manualTrigger","position":[380,240],"typeVersion":1,"disabled":true},{"parameters":{"content":"# Auto Categorise Outlook Emails with AI","height":110.58643966444157,"width":727.9032097745135,"color":7},"id":"d16f59dd-f54e-487b-9aac-67f109ba9869","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[1940,-480],"typeVersion":1},{"parameters":{"model":"llama3.1:latest","options":{"temperature":0.2}},"id":"9d79875f-148e-46ef-967a-95c07298456d","name":"Ollama Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOllama","position":[2069,484],"typeVersion":1,"credentials":{"ollamaApi":{"id":"U7aP1bMjOcBIHIwi","name":"Ollama account"}}},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"100db1cb-3819-43c7-a74b-5c087ad4f2da","name":"Microsoft Outlook12","type":"n8n-nodes-base.microsoftOutlook","position":[3640,-192],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"options":{}},"id":"d4969259-a3ae-473d-82ef-0c9f7933c899","name":"Loop Over Items1","type":"n8n-nodes-base.splitInBatches","position":[1100,248],"typeVersion":3},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"524f6be3-7708-4aae-b9ab-e0ef8180a627","name":"Microsoft Outlook13","type":"n8n-nodes-base.microsoftOutlook","position":[3640,-12],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"e4446e84-c05e-4d04-b415-7608e39024ee","name":"Microsoft Outlook16","type":"n8n-nodes-base.microsoftOutlook","position":[3649,304],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"2fcecd9e-95cc-489a-b874-699c54518e44","name":"Microsoft Outlook18","type":"n8n-nodes-base.microsoftOutlook","position":[3649,144],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"html":"={{ $('Loop Over Items1').item.json.body.content }}","options":{}},"id":"ebf606f9-099c-4218-b23b-66e2487262d0","name":"Markdown1","type":"n8n-nodes-base.markdown","position":[1360,268],"notesInFlow":true,"typeVersion":1,"notes":"Converts the body of the email to markdown"},{"parameters":{"assignments":{"assignments":[{"id":"edb304e1-3e9f-4a77-918c-25646addbc53","name":"subject","type":"string","value":"={{ $json.subject }}"},{"id":"57a3ef3a-2701-40d9-882f-f43a7219f148","name":"importance","type":"string","value":"={{ $json.importance }}"},{"id":"d8317f4f-aa0e-4196-89af-cb016765490a","name":"sender","type":"object","value":"={{ $json.sender.emailAddress }}"},{"id":"908716c8-9ff7-4bdc-a1a3-64227559635e","name":"from","type":"object","value":"={{ $json.from.emailAddress }}"},{"id":"ce007329-e221-4c5a-8130-2f8e9130160f","name":"body","type":"string","value":"={{ $json.data\n    .replace(/<[^>]*>/g, '')                      // Remove HTML tags\n    .replace(/\\[(.*?)\\]\\((.*?)\\)/g, '')            // Remove Markdown links like [text](link)\n    .replace(/!\\[.*?\\]\\(.*?\\)/g, '')               // Remove Markdown images like ![alt](image-link)\n    .replace(/\\|/g, '')                            // Remove table separators \"|\"\n    .replace(/-{3,}/g, '')                         // Remove horizontal rule \"---\"\n    .replace(/\\n+/g, ' ')                          // Remove multiple newlines\n    .replace(/([^\\w\\s.,!?@])/g, '')                // Remove special characters except essential ones\n    .replace(/\\s{2,}/g, ' ')                       // Replace multiple spaces with a single space\n    .trim()                                        // Trim leading/trailing whitespace\n}}\n"}]},"options":{}},"id":"ff447dd5-3ef6-4a02-8453-3489af8bf6b5","name":"varEmal1","type":"n8n-nodes-base.set","position":[1560,268],"typeVersion":3.4,"notes":"Set email fields"},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"198524cb-c9f0-4261-8c38-7c878efe7457","name":"Microsoft Outlook20","type":"n8n-nodes-base.microsoftOutlook","position":[3640,460],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"ec73629c-59ac-4f0e-a432-2c06934952ab","name":"Microsoft Outlook21","type":"n8n-nodes-base.microsoftOutlook","position":[3649,844],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"c8cd6917-f94e-4fb7-8601-b8ed8f1aa8bf","operator":{"type":"array","operation":"empty","singleValue":true},"leftValue":"={{ $json.categories }}","rightValue":""}]},"options":{}},"id":"0a19d15c-0cd3-4f26-9be2-4914522751fb","name":"Filter1","type":"n8n-nodes-base.filter","position":[840,248],"typeVersion":2.2},{"parameters":{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"f8cf2a56-cea8-4150-b7a0-048dbda20f2f","operator":{"type":"boolean","operation":"true","singleValue":true},"leftValue":"={{ $json.isRead }}","rightValue":""}]},"options":{}},"id":"96e6e31c-6306-44a8-a57a-2b5216636b00","name":"If1","type":"n8n-nodes-base.if","position":[4260,468],"typeVersion":2.2,"notes":"Checks if the email has been read"},{"parameters":{"operation":"update","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"updateFields":{"categories":"={{ \n  [$('varJSON1').first().json.output.category, $('varJSON1').first().json.output.subCategory]\n    .filter(item => item && item.trim() !== \"\")\n    .map(item => item.charAt(0).toUpperCase() + item.slice(1))\n}}"}},"id":"8a6e0118-abe3-45e2-aefc-94640348b2ec","name":"Microsoft Outlook22","type":"n8n-nodes-base.microsoftOutlook","position":[3649,664],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"assignments":{"assignments":[{"id":"0dc6d439-60fb-49f6-b4d5-f5cce6f030ad","name":"error","type":"string","value":"={{ $json }}"}]},"options":{}},"id":"e2d8e7b5-4447-4327-9f4e-b8d52765667e","name":"Catch Errors1","type":"n8n-nodes-base.set","position":[2700,408],"typeVersion":3.4},{"parameters":{"assignments":{"assignments":[{"id":"0c52f57f-74eb-4385-ac6b-f3e5f4f50e73","name":"output","type":"object","value":"={{ $json.output.replace(/^.*?({.*}).*$/s, '$1') }}"}]},"options":{"ignoreConversionErrors":true}},"id":"17f6ac43-51e4-4bee-b0d8-13deb3bf3cc9","name":"varJSON1","type":"n8n-nodes-base.set","position":[2480,268],"typeVersion":3.4,"onError":"continueErrorOutput"},{"parameters":{"content":"## Outlook Business with filters\nFilters:\n```\nflag/flagStatus eq 'notFlagged' and not categories/any()\n```\n\nThese filters ensure we do not process flagged emails or email that already have a category set.","height":401.49417117683515,"width":411.91693012378937},"id":"82dd9631-a34b-4d54-be28-6f8dcc3548f0","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","position":[580,20],"typeVersion":1},{"parameters":{"operation":"getAll","limit":10,"output":"fields","fields":["flag","from","importance","replyTo","sender","subject","toRecipients","body","categories","isRead"],"filtersUI":{"values":{"filters":{"custom":"flag/flagStatus eq 'notFlagged' and not categories/any()","foldersToInclude":["AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAAAIBDAAAAA=="]}}},"options":{}},"id":"0583e196-37a5-43db-8c0a-aa624029c926","name":"Microsoft Outlook23","type":"n8n-nodes-base.microsoftOutlook","position":[640,240],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}},"disabled":true},{"parameters":{"assignments":{"assignments":[{"id":"de2ad4f2-7381-4715-a3f4-59611e161b74","name":"id","type":"string","value":"={{ $('Microsoft Outlook Trigger').item.json.id }}"},{"id":"458c7a89-e4a3-46d0-8b38-72d87748e306","name":"category","type":"string","value":"\"action\", \"junk\", \"receipt\", \"SaaS\", \"community\", \"business\" or \"other\""}]},"options":{}},"id":"a9540e6b-929b-4460-8972-93e4d19cd934","name":"varID & Category1","type":"n8n-nodes-base.set","position":[1840,260],"typeVersion":3.4},{"parameters":{"content":"## Sanitise Email \nRemoves HTML and useless information in preparation for the AI Agent","height":301.40952380952365,"width":418.7820408163265,"color":6},"id":"e6b3b41e-d7d3-4c9b-8189-a005c748ff18","name":"Sticky Note11","type":"n8n-nodes-base.stickyNote","position":[1300,148],"typeVersion":1},{"parameters":{"content":"## Modify Categories \nEdit this to customise category selection","height":298.37931972789124,"width":256.16108843537415,"color":6},"id":"f9787a75-526c-4ef1-b0a7-0db7d890ab3f","name":"Sticky Note12","type":"n8n-nodes-base.stickyNote","position":[1760,148],"typeVersion":1},{"parameters":{"content":"## Convert to JSON\n* Ensures the Agent output to converted to JSON\n* Catches any errors and continues processing","height":463.0204081632651,"width":441.003537414966,"color":5},"id":"50223a01-34cf-4191-9dd7-3dac02a9e945","name":"Sticky Note13","type":"n8n-nodes-base.stickyNote","position":[2420,128],"typeVersion":1},{"parameters":{"content":"## Switch Categories\nEnsure your categories match the **varID & Category** Edit Fields node","height":454.93986394557805,"width":311.71482993197264,"color":5},"id":"4580c532-96a6-46b4-8922-d79316d1cc01","name":"Sticky Note14","type":"n8n-nodes-base.stickyNote","position":[3060,128],"typeVersion":1},{"parameters":{"content":"## Set Categories\n","height":1289.0156245602684,"width":251.3480889735252,"color":4},"id":"b51a7c34-2a5e-4670-81a4-d1582711c69a","name":"Sticky Note15","type":"n8n-nodes-base.stickyNote","position":[3569,-276],"typeVersion":1},{"parameters":{"content":"## Move to Folders\n","height":770.995811762121,"width":251.3480889735252,"color":4},"id":"3a7ede7b-539b-49d2-8803-153ca6c9eb69","name":"Sticky Note16","type":"n8n-nodes-base.stickyNote","position":[3889,-276],"typeVersion":1},{"parameters":{"content":"## Check if email has been read\n\n","height":293.65527013262994,"color":4},"id":"ee9a9d78-8c07-470a-9d1b-ceddfc8875ca","name":"Sticky Note17","type":"n8n-nodes-base.stickyNote","position":[4200,353],"typeVersion":1},{"parameters":{"promptType":"define","text":"=Categorise the following email\n<email>\n{{ $('varEmal1').first().json.toJsonString() }}\n</email>\n\nEnsure your final output is valid JSON with no additional text or token in the following format:\n\n{\n  \"subject\": \"SUBJECT_LINE\",1\n  \"category\": \"CATEGORY\",\n  \"subCategory\": \"SUBCATEGORY\", //use sparingly\n  \"analysis\": \"ANALYSIS_REASONING\"\n}\n\nRemember you can only use ONE of the following categories {{ $json.category }}. No other categories can be used. Use the subcategory for additional context, for example, if a SaaS email requires action, or if a business email requires action. Do not create any additional subcategories, you can only use ONE of the following {{ $json.category }}.","hasOutputParser":true,"options":{"systemMessage":"=You're an AI assistant for a freelance developer, categorizing emails as {{ $json.category }}. Email info is in <email> tags.\n\nCategorization priority:\n\nAction: Needs response or action (includes some SaaS emails), avoid sales email but include enquires.\nJunk: Ads, sales, newsletters, promotions, daily digests, (emojis often indicate junk), phishing, scams, discounts etc.\nReceipt: Any purchase confirmation.\nSaaS: Account/security updates, unless action required, generic SaaS information, usually from a non-personal email address.\nCommunity: Updates, events, forums, everything related to \"community\".\nBusiness: Any communication related to freelance work, usually from a humans email address\nOther: Doesn't fit into any other category.\n\nKey points:\n\nSaaS emails needing action are \"SaaS\" and subcategory \"action\".\nAnalyze the subject, body, email addresses and other data.\nLook for specific keywords and phrases for each category.\nEmail can have 2 categories, primary and sub, for example, \"action\" and \"SaaS\" or \"action\" and \"business\".\nEmails from business development executives are often junk.\n\n\nOutput in valid JSON format:\n{\n\"subject\": \"SUBJECT_LINE\",\n\"category\": \"PRIMARY CATEGORY\",\n\"subCategory\": \"SUBCATEGORY\", //use sparingly\n\"analysis\": \"Brief 1-2 sentence explanation of category choice\"\n}\nNo additional text or tokens outside the JSON.\n\nYou may only use the following categories and subcategories, do not create any more categories or subcategories: {{ $json.category }}"}},"id":"85ff0348-16dc-46e6-bf70-48a10fe0ded8","name":"AI Agent1","type":"@n8n/n8n-nodes-langchain.agent","position":[2100,268],"typeVersion":1.6},{"parameters":{"numberInputs":7},"id":"93e7be79-9035-4b58-9a83-b9182a0515f8","name":"Merge1","type":"n8n-nodes-base.merge","position":[4929,364],"typeVersion":3},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":false,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.output.category }}","rightValue":"junk"}]},"renameOutput":true,"outputKey":"junk"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":false,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0c61c7a8-e8b4-49c5-a96c-402d5eae7089","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.output.category }}","rightValue":"receipt"}]},"renameOutput":true,"outputKey":"receipt"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":false,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"703f65c8-cf4a-47fe-ad1a-a5f6e0412ae7","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.output.category }}","rightValue":"SaaS"}]},"renameOutput":true,"outputKey":"SaaS"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":false,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"b074d5cd-9215-40df-8877-5df904edc000","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.output.category }}","rightValue":"community"}]},"renameOutput":true,"outputKey":"community"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":false,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"bece338a-e0c5-43b5-b8cc-41229a374213","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.output.category }}","rightValue":"action"}]},"renameOutput":true,"outputKey":"action"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":false,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"d6c9751f-0ffa-4041-a579-6957bb9c9296","operator":{"name":"filter.operator.equals","type":"string","operation":"equals"},"leftValue":"={{ $json.output.category }}","rightValue":"business"}]},"renameOutput":true,"outputKey":"business"}]},"options":{"fallbackOutput":"extra","ignoreCase":true}},"id":"cbaeaed1-cb09-4614-93f1-3fe349cd0e4e","name":"Switch1","type":"n8n-nodes-base.switch","position":[3160,288],"typeVersion":3.2},{"parameters":{"operation":"move","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"folderId":{"__rl":true,"value":"AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAB4TGHiwAAAA=","mode":"list","cachedResultName":"Receipt ","cachedResultUrl":"https://outlook.office365.com/mail/AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAB4TGHiwAAAA%3D"}},"id":"72cb54f3-4e4e-4ad2-8845-11a38fc29f1a","name":"Receipt","type":"n8n-nodes-base.microsoftOutlook","position":[3960,-20],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"folderId":{"__rl":true,"value":"AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAB4TGHisAAAA=","mode":"list","cachedResultName":"SaaS","cachedResultUrl":"https://outlook.office365.com/mail/AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAB4TGHisAAAA%3D"}},"id":"41a39309-1a94-461f-9308-63dd5b9a94a7","name":"SaaS","type":"n8n-nodes-base.microsoftOutlook","position":[3960,148],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"folderId":{"__rl":true,"value":"AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAB4TGHi0AAAA=","mode":"list","cachedResultName":"Community","cachedResultUrl":"https://outlook.office365.com/mail/AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAB4TGHi0AAAA%3D"}},"id":"3ee05cfe-a528-472e-aa3d-c890fd88b6c4","name":"Community","type":"n8n-nodes-base.microsoftOutlook","position":[3960,308],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"folderId":{"__rl":true,"value":"AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAAAIBIgAAAA==","mode":"list","cachedResultName":"Junk Email","cachedResultUrl":"https://outlook.office365.com/mail/AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAAAIBIgAAAA%3D%3D"}},"id":"bcf92a71-ff5f-46a7-bec3-cedb5be2bf98","name":"Junk Email","type":"n8n-nodes-base.microsoftOutlook","position":[3960,-192],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"mode":"id","value":"={{ $('varID & Category1').item.json.id }}"},"folderId":{"__rl":true,"mode":"list","value":"AQMkAGE3ZTU5MGMzLTFkNGItNGQ5Zi04MDQ1LThmNGFlMTVhYjMwYgAuAAAD8UhruVwm402lgPBG2Tj-aQEAnz-IOcWBGE2lrVuQgAF6zAADLJmrCwAAAA==","cachedResultUrl":"https://outlook.office365.com/mail/AQMkAGE3ZTU5MGMzLTFkNGItNGQ5Zi04MDQ1LThmNGFlMTVhYjMwYgAuAAAD8UhruVwm402lgPBG2Tj%2FaQEAnz%2FIOcWBGE2lrVuQgAF6zAADLJmrCwAAAA%3D%3D","cachedResultName":"Actioned"}},"id":"c75b9d38-79a7-4be2-a90b-a99da1bbd745","name":"Actioned","type":"n8n-nodes-base.microsoftOutlook","position":[4549,404],"typeVersion":2,"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"output":"fields","fields":["flag","from","importance","replyTo","sender","subject","toRecipients","body","categories","isRead"],"filters":{"custom":"flag/flagStatus eq 'notFlagged' and not categories/any()","foldersToInclude":["AQMkADAwATYwMAItOTY4ZC0wZTcxLTAwAi0wMAoALgAAA1jKGrDN_RBCn7ACBndpmjsBANEOnyC7ZDdGvqCSLEudpZgAAAIBDAAAAA=="]},"options":{}},"id":"db5846e3-b656-4a08-910a-1bf31a829d55","name":"Microsoft Outlook Trigger","type":"n8n-nodes-base.microsoftOutlookTrigger","typeVersion":1,"position":[640,460],"credentials":{"microsoftOutlookOAuth2Api":{"id":"NccrNHW818CX3pdM","name":"Microsoft Outlook account"}}}],"connections":{"If1":{"main":[[{"node":"Actioned","type":"main","index":0}],[{"node":"Merge1","type":"main","index":5}]]},"Merge1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Filter1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"Microsoft Outlook12","type":"main","index":0}],[{"node":"Microsoft Outlook13","type":"main","index":0}],[{"node":"Microsoft Outlook18","type":"main","index":0}],[{"node":"Microsoft Outlook16","type":"main","index":0}],[{"node":"Microsoft Outlook20","type":"main","index":0}],[{"node":"Microsoft Outlook22","type":"main","index":0}],[{"node":"Microsoft Outlook21","type":"main","index":0}]]},"varEmal1":{"main":[[{"node":"varID & Category1","type":"main","index":0}]]},"varJSON1":{"main":[[{"node":"Switch1","type":"main","index":0}],[{"node":"Catch Errors1","type":"main","index":0}]]},"AI Agent1":{"main":[[{"node":"varJSON1","type":"main","index":0}]]},"Markdown1":{"main":[[{"node":"varEmal1","type":"main","index":0}]]},"Catch Errors1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"Markdown1","type":"main","index":0}]]},"varID & Category1":{"main":[[{"node":"AI Agent1","type":"main","index":0}]]},"Ollama Chat Model1":{"ai_languageModel":[[{"node":"AI Agent1","type":"ai_languageModel","index":0}]]},"Microsoft Outlook12":{"main":[[{"node":"Junk Email","type":"main","index":0}]]},"Microsoft Outlook13":{"main":[[{"node":"Receipt","type":"main","index":0}]]},"Microsoft Outlook16":{"main":[[{"node":"Community","type":"main","index":0}]]},"Microsoft Outlook18":{"main":[[{"node":"SaaS","type":"main","index":0}]]},"Microsoft Outlook20":{"main":[[{"node":"If1","type":"main","index":0}]]},"Microsoft Outlook21":{"main":[[{"node":"Merge1","type":"main","index":6}]]},"Microsoft Outlook22":{"main":[[{"node":"If1","type":"main","index":0}]]},"Microsoft Outlook23":{"main":[[{"node":"Filter1","type":"main","index":0}]]},"When clicking ‘Test workflow’":{"main":[[{"node":"Microsoft Outlook23","type":"main","index":0}]]},"Receipt":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"SaaS":{"main":[[{"node":"Merge1","type":"main","index":2}]]},"Community":{"main":[[{"node":"Merge1","type":"main","index":3}]]},"Junk Email":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Actioned":{"main":[[{"node":"Merge1","type":"main","index":4}]]},"Microsoft Outlook Trigger":{"main":[[{"node":"Filter1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Microsoft Outlook Trigger":{"lastTimeChecked":"2024-10-30T04:01:24.756-04:00"}},"meta":{"templateId":"2454","templateCredsSetupCompleted":true,"instanceId":"3a5745a05f87ddee1db68b217dc043bfa206d1c7aaa1dd0a7dd76b852a733597"},"pinData":{},"versionId":"126b5fa7-fc7f-4f10-8070-b350fc05da56","triggerCount":1,"tags":[]},{"createdAt":"2024-10-28T10:12:56.233Z","updatedAt":"2024-10-28T10:12:56.233Z","id":"JLetXj5m1sE3jq8i","name":"My workflow","active":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"minutes"}]}},"id":"3b548de0-f077-4c31-adae-868c7c994d75","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[460,460]},{"parameters":{},"id":"14fd51a6-508c-498f-8a39-714094a3085b","name":"Read Documents","type":"n8n-nodes-base.readBinaryFiles","typeVersion":1,"position":[660,460]},{"parameters":{"functionCode":"// Convert binary data to text\nfor (item of items) {\n  if (item.binary.data) {\n    item.json = {\n      text: item.binary.data.toString('utf8'),\n      filename: item.binary.filename\n    };\n  }\n}\nreturn items;"},"id":"b2077ecf-5c6f-437e-9f66-451b03b2ee73","name":"Process Documents","type":"n8n-nodes-base.function","typeVersion":1,"position":[860,460]},{"parameters":{"options":{"maxTokens":8000},"requestOptions":{}},"id":"ebf0c8fe-1a13-4b08-8155-41487ac7184e","name":"Generate Embeddings","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1060,460]},{"parameters":{"additionalFields":{}},"id":"2f0601d8-bf13-4dc8-bbfd-7f31b6b3fd20","name":"Store in Vector DB","type":"n8n-nodes-base.postgres","typeVersion":1,"position":[1260,460]},{"parameters":{"httpMethod":"POST","path":"query","responseMode":"responseNode","options":{}},"id":"879bdb5f-0fb0-408d-a197-d4b124aeba8e","name":"Query Endpoint","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[460,660]},{"parameters":{"options":{"maxTokens":8000},"requestOptions":{}},"id":"b81f161c-e3e4-41c3-a113-6232b814bddd","name":"Query Embedding","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[660,660]},{"parameters":{"operation":"select","additionalFields":{}},"id":"8b2c6dac-b0a1-462e-8f6e-309e1cf82a77","name":"Retrieve Similar Docs","type":"n8n-nodes-base.postgres","typeVersion":1,"position":[860,660]},{"parameters":{"prompt":"Based on the following context, please answer this question: {{ $json.query }}\n\nContext:\n{{ $json.relevantDocs }}","options":{"maxTokens":500,"temperature":0.7},"requestOptions":{}},"id":"5a718813-17df-45fb-8e21-42c2e9047e1d","name":"Generate Answer","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[1060,660]},{"parameters":{"respondWith":"json","options":{}},"id":"e2e86260-0623-4973-9503-838b9bba5b3d","name":"HTTP Response","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1260,660]}],"connections":{"Schedule Trigger":{"main":[[{"node":"Read Documents","type":"main","index":0}]]},"Read Documents":{"main":[[{"node":"Process Documents","type":"main","index":0}]]},"Process Documents":{"main":[[{"node":"Generate Embeddings","type":"main","index":0}]]},"Generate Embeddings":{"main":[[{"node":"Store in Vector DB","type":"main","index":0}]]},"Query Endpoint":{"main":[[{"node":"Query Embedding","type":"main","index":0}]]},"Query Embedding":{"main":[[{"node":"Retrieve Similar Docs","type":"main","index":0}]]},"Retrieve Similar Docs":{"main":[[{"node":"Generate Answer","type":"main","index":0}]]},"Generate Answer":{"main":[[{"node":"HTTP Response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"94c5fbf9-3067-4ae8-88c2-fe9ffb2d7cec","triggerCount":0,"tags":[]},{"createdAt":"2024-10-27T20:38:26.406Z","updatedAt":"2024-10-27T20:38:26.406Z","id":"Td4ARlDSEVu8skQy","name":"Building RAG Chatbot for Movie Recommendations with Qdrant and Open AI","active":false,"nodes":[{"parameters":{},"id":"06a34e3b-519a-4b48-afd0-4f2b51d2105d","name":"When clicking ‘Test workflow’","type":"n8n-nodes-base.manualTrigger","position":[680,260],"typeVersion":1},{"parameters":{"resource":"file","operation":"get","owner":{"__rl":true,"mode":"name","value":"mrscoopers"},"repository":{"__rl":true,"mode":"list","value":"n8n_demo","cachedResultUrl":"https://github.com/mrscoopers/n8n_demo","cachedResultName":"n8n_demo"},"filePath":"Top_1000_IMDB_movies.csv","additionalParameters":{}},"id":"9213003d-433f-41ab-838b-be93860261b2","name":"GitHub","type":"n8n-nodes-base.github","position":[900,260],"typeVersion":1},{"parameters":{"options":{}},"id":"9850d1a9-3a6f-44c0-9f9d-4d20fda0b602","name":"Extract from File","type":"n8n-nodes-base.extractFromFile","position":[1060,260],"typeVersion":1},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"7704f993-b1c9-477a-8b5a-77dc2cb68161","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[1260,460],"typeVersion":1},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $('Extract from File').item.json.Description }}","options":{"metadata":{"metadataValues":[{"name":"movie_name","value":"={{ $('Extract from File').item.json['Movie Name'] }}"},{"name":"movie_release_date","value":"={{ $('Extract from File').item.json['Year of Release'] }}"},{"name":"movie_description","value":"={{ $('Extract from File').item.json.Description }}"}]}}},"id":"bc6dd8e5-0186-4bf9-9c60-2eab6d9b6520","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[1400,480],"typeVersion":1},{"parameters":{},"id":"f87ea014-fe79-444b-88ea-0c4773872b0a","name":"Token Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterTokenSplitter","position":[1400,660],"typeVersion":1},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"mode":"id","value":"imdb"},"options":{}},"id":"d8d28cec-c8e8-4350-9e98-cdbc6da54988","name":"Qdrant Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[1300,260],"typeVersion":1},{"parameters":{"options":{}},"id":"f86e03dc-12ea-4929-9035-4ec3cf46e300","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","position":[620,660],"webhookId":"71bfe0f8-227e-466b-9d07-69fd9fe4a27b","typeVersion":1.1},{"parameters":{"model":"gpt-4o-mini","options":{}},"id":"ead23ef6-2b6b-428d-b412-b3394bff8248","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[740,860],"typeVersion":1},{"parameters":{"name":"movie_recommender","description":"Call this tool to get a list of recommended movies from a vector database. ","workflowId":{"__rl":true,"mode":"id","value":"a58HZKwcOy7lmz56"},"specifyInputSchema":true,"schemaType":"manual","inputSchema":"{\n\"type\": \"object\",\n\"properties\": {\n\t\"positive_example\": {\n      \"type\": \"string\",\n      \"description\": \"A string with a movie description matching the user's positive recommendation request\"\n    },\n    \"negative_example\": {\n      \"type\": \"string\",\n      \"description\": \"A string with a movie description matching the user's negative anti-recommendation reuqest\"\n    }\n}\n}"},"id":"7ab936e1-aac8-43bc-a497-f2d02c2c19e5","name":"Call n8n Workflow Tool","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[1020,860],"typeVersion":1.2},{"parameters":{},"id":"ce55f334-698b-45b1-9e12-0eaa473187d4","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[860,860],"typeVersion":1.2},{"parameters":{},"id":"41c1ee11-3117-4765-98fc-e56cc6fc8fb2","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","position":[1340,1120],"typeVersion":1},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"id":"db8d6ab6-8cd2-4a8c-993d-f1b7d7fdcffd","name":"Merge","type":"n8n-nodes-base.merge","position":[2240,1020],"typeVersion":3},{"parameters":{"fieldToSplitOut":"result","options":{}},"id":"c7bc5e04-22b1-40db-ba74-1ab234e51375","name":"Split Out","type":"n8n-nodes-base.splitOut","position":[2960,1000],"typeVersion":1},{"parameters":{"fieldToSplitOut":"result.points","options":{}},"id":"a2002d2e-362a-49eb-a42d-7b665ddd67a0","name":"Split Out1","type":"n8n-nodes-base.splitOut","position":[2840,780],"typeVersion":1},{"parameters":{"mode":"combine","fieldsToMatchString":"id","options":{}},"id":"f69a87f1-bfb9-4337-9350-28d2416c1580","name":"Merge1","type":"n8n-nodes-base.merge","position":[3220,920],"typeVersion":3},{"parameters":{"aggregate":"aggregateAllItemData","destinationFieldName":"response","options":{}},"id":"b2f2529e-e260-4d72-88ef-09b804226004","name":"Aggregate","type":"n8n-nodes-base.aggregate","position":[3660,920],"typeVersion":1},{"parameters":{"options":{"systemMessage":"You are a Movie Recommender Tool using a Vector Database under the hood. Provide top-3 movie recommendations returned by the database, ordered by their recommendation score, but not showing the score to the user."}},"id":"bedea10f-b4de-4f0e-9d60-cc8117a2b328","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[840,660],"typeVersion":1.6},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/embeddings","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"input","value":"={{ $json.query.positive_example }}"},{"name":"model","value":"text-embedding-3-small"}]},"options":{}},"id":"e04276b5-7d69-437b-bf4f-9717808cc8f6","name":"Embedding Recommendation Request with Open AI","type":"n8n-nodes-base.httpRequest","position":[1600,980],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/embeddings","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer $OPENAI_API_KEY"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"input","value":"={{ $json.query.negative_example }}"},{"name":"model","value":"text-embedding-3-small"}]},"options":{}},"id":"68e99f06-82f5-432c-8b31-8a1ae34981a6","name":"Embedding Anti-Recommendation Request with Open AI","type":"n8n-nodes-base.httpRequest","position":[1620,1180],"typeVersion":4.2},{"parameters":{"assignments":{"assignments":[{"id":"01a28c9d-aeb1-48bb-8a73-f8bddbd73460","name":"positive_example","type":"array","value":"={{ $json.data[0].embedding }}"}]},"options":{}},"id":"ecb1d7e1-b389-48e8-a34a-176bfc923641","name":"Extracting Embedding","type":"n8n-nodes-base.set","position":[1880,980],"typeVersion":3.4},{"parameters":{"assignments":{"assignments":[{"id":"01a28c9d-aeb1-48bb-8a73-f8bddbd73460","name":"negative_example","type":"array","value":"={{ $json.data[0].embedding }}"}]},"options":{}},"id":"4ed11142-a734-435f-9f7a-f59e2d423076","name":"Extracting Embedding1","type":"n8n-nodes-base.set","position":[1880,1180],"typeVersion":3.4},{"parameters":{"method":"POST","url":"https://edcc6735-2ffb-484f-b735-3467043828fe.europe-west3-0.gcp.cloud.qdrant.io:6333/collections/imdb_1000_open_ai/points/query","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": {\n    \"recommend\": {\n      \"positive\": [[{{ $json.positive_example }}]],\n      \"negative\": [[{{ $json.negative_example }}]],\n      \"strategy\": \"average_vector\"\n    }\n  },\n  \"limit\":3\n}","options":{}},"id":"ce3aa9bc-a5b1-4529-bff5-e0dba43b99f3","name":"Calling Qdrant Recommendation API","type":"n8n-nodes-base.httpRequest","position":[2540,1020],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://edcc6735-2ffb-484f-b735-3467043828fe.europe-west3-0.gcp.cloud.qdrant.io:6333/collections/imdb_1000_open_ai/points","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"ids\": [\"{{ $json.result.points[0].id }}\", \"{{ $json.result.points[1].id }}\", \"{{ $json.result.points[2].id }}\"],\n    \"with_payload\":true\n}","options":{}},"id":"9b8a6bdb-16fe-4edc-86d0-136fe059a777","name":"Retrieving Recommended Movies Meta Data","type":"n8n-nodes-base.httpRequest","position":[2760,980],"typeVersion":4.2},{"parameters":{"assignments":{"assignments":[{"id":"b4b520a5-d0e2-4dcb-af9d-0b7748fd44d6","name":"movie_recommendation_score","type":"number","value":"={{ $json.score }}"},{"id":"c9f0982e-bd4e-484b-9eab-7e69e333f706","name":"movie_description","type":"string","value":"={{ $json.payload.content }}"},{"id":"7c7baf11-89cd-4695-9f37-13eca7e01163","name":"movie_name","type":"string","value":"={{ $json.payload.metadata.movie_name }}"},{"id":"1d1d269e-43c7-47b0-859b-268adf2dbc21","name":"movie_release_year","type":"string","value":"={{ $json.payload.metadata.release_year }}"}]},"options":{}},"id":"28cdcad5-3dca-48a1-b626-19eef657114c","name":"Selecting Fields Relevant for Agent","type":"n8n-nodes-base.set","position":[3440,920],"typeVersion":3.4},{"parameters":{"content":"Tool, calling Qdrant's recommendation API based on user's request, transformed by AI agent"},"id":"56e73f01-5557-460a-9a63-01357a1b456f","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[1260,1300],"typeVersion":1},{"parameters":{"content":"Uploading data (movies and their descriptions) to Qdrant Vector Store\n"},"id":"cce5250e-0285-4fd0-857f-4b117151cd8b","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[380,240],"typeVersion":1}],"connections":{"Merge":{"main":[[{"node":"Calling Qdrant Recommendation API","type":"main","index":0}]]},"GitHub":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Selecting Fields Relevant for Agent","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Split Out1":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Token Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Extract from File":{"main":[[{"node":"Qdrant Vector Store","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store","type":"ai_document","index":0}]]},"Extracting Embedding":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Extracting Embedding1":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Call n8n Workflow Tool":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"Embedding Recommendation Request with Open AI","type":"main","index":0},{"node":"Embedding Anti-Recommendation Request with Open AI","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Calling Qdrant Recommendation API":{"main":[[{"node":"Retrieving Recommended Movies Meta Data","type":"main","index":0},{"node":"Split Out1","type":"main","index":0}]]},"When clicking ‘Test workflow’":{"main":[[{"node":"GitHub","type":"main","index":0}]]},"Selecting Fields Relevant for Agent":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Retrieving Recommended Movies Meta Data":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Embedding Recommendation Request with Open AI":{"main":[[{"node":"Extracting Embedding","type":"main","index":0}]]},"Embedding Anti-Recommendation Request with Open AI":{"main":[[{"node":"Extracting Embedding1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateId":"2440"},"pinData":{},"versionId":"602a8523-347c-4d58-a4d0-f1a421ea86cc","triggerCount":0,"tags":[]}]